<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Asteroid Impact Simulator — Select & Configure</title>
<style>
  :root { --bg:#0b1d46; --panel:#e3e3e7; --ink:#0f0f14; --card:#0f224f; --accent:#ff4b4b; }
  *{ box-sizing:border-box; }
  body{ margin:0; background:var(--bg); color:#fff; font-family:Inter,system-ui,Arial,sans-serif; }
  .wrap{ min-height:100vh; max-width:900px; padding:56px 20px; margin:0 auto; }
  .title{ margin:0 0 16px; font-size:44px; font-weight:900; letter-spacing:.3px; }
  .dropdown{ position:relative; width:min(620px,92vw); }
  .dd-btn{
    width:100%; background:var(--panel); color:var(--ink);
    border:1px solid #94a3b8; border-radius:12px;
    height:60px; padding:0 16px; font-size:18px;
    display:flex; align-items:center; justify-content:space-between;
    cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,.25);
  }
  .caret{ margin-left:12px; cursor:pointer; }
  .dd-menu{
    position:absolute; left:0; right:0; top:70px; z-index:50;
    background:#f7f8fb; color:#111; border:1px solid #cbd5e1; border-radius:12px;
    box-shadow:0 14px 28px rgba(0,0,0,.35);
    max-height:300px; overflow:auto; display:none; padding:0; margin:0; list-style:none;
  }
  .dd-menu.show{ display:block; }
  .dd-item{ padding:12px 14px; border-bottom:1px solid #e5e7eb; cursor:pointer; font-size:16px; }
  .dd-item:last-child{ border-bottom:none; }
  .dd-item:hover{ background:#e9ecff; }
  .panel{ margin-top:18px; background:var(--card); border:1px solid #1e3a8a; border-radius:12px; padding:16px; box-shadow:0 10px 20px rgba(0,0,0,.25); }
  .hidden{ display:none; }
  .grid{ display:grid; grid-template-columns:160px 1fr; gap:8px 12px; margin:10px 0 8px; }
  .k{ opacity:.9; font-weight:700; }
  .v{ opacity:.95; }
  .controls{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:12px; }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .field{ background:#0a1a3a; border:1px solid #1f3b74; border-radius:10px; padding:10px; }
  label{ font-size:13px; opacity:.9; display:block; margin-bottom:6px; }
  input[type="number"], select, input[type="range"]{
    width:100%; background:#0b1d46; color:#fff; border:1px solid #294785; border-radius:8px; padding:8px 10px; font-size:14px;
  }
  input[type="range"]{ height:32px; }
  .inline{ display:grid; grid-template-columns:1fr 120px; gap:10px; align-items:center; }
  .tag{ display:inline-block; font-size:12px; background:#09204a; border:1px solid #1f3b74; padding:2px 8px; border-radius:999px; }
  .actions{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; }
  .btn{ background:#334155; border:0; color:#fff; padding:10px 14px; font-weight:700; border-radius:10px; cursor:pointer; }
  .btn.primary{ background:var(--accent); }
  .hint{ font-size:12px; opacity:.8; }
</style>
</head>
<body>
  <main class="wrap">
    <h1 class="title">Asteroid — Select & Configure</h1>

    <!-- Dropdown -->
    <section class="dropdown" id="dropdownRoot">
      <button id="ddBtn" class="dd-btn" aria-haspopup="listbox" aria-expanded="false">
        <span id="ddLabel">Select Asteroid</span>
        <span id="ddCaret" class="caret" aria-label="Change asteroid" title="Change asteroid">▼</span>
      </button>
      <ul id="ddMenu" class="dd-menu" role="listbox" tabindex="-1" aria-label="Asteroid list"></ul>
    </section>

    <!-- Result + extra parameters -->
    <section id="result" class="panel hidden">
      <h2 style="margin:0 0 10px">Selected asteroid</h2>

      <div class="grid">
        <div class="k">Name</div>     <div id="rName" class="v">—</div>
        <div class="k">Hazard</div>   <div id="rHaz" class="v">—</div>
        <div class="k">Diameter</div> <div id="rDia" class="v">—</div>
        <div class="k">Speed (ref)</div> <div id="rVel" class="v">—</div>
      </div>

      <div class="controls">
        <!-- Composition -->
        <div class="field">
          <label for="comp">Composition</label>
          <div class="row">
            <select id="comp" aria-label="Composition">
              <option value="ice" data-density="900">Ice (≈ 900 kg/m³)</option>
              <option value="stony" data-density="3000" selected>Stony (≈ 3000 kg/m³)</option>
              <option value="stony_iron" data-density="4000">Stony-Iron (≈ 4000 kg/m³)</option>
              <option value="iron" data-density="7800">Iron (≈ 7800 kg/m³)</option>
            </select>
            <span id="rhoTag" class="tag">ρ = 3000 kg/m³</span>
          </div>
          <div class="hint">Composition sets density used in the simulation.</div>
        </div>

        <!-- Editable speed -->
        <div class="field">
          <label for="velRange">Entry speed (km/s)</label>
          <div class="inline">
            <input id="velRange" type="range" min="5" max="72" step="0.1" value="17">
            <input id="velInput" type="number" min="5" max="72" step="0.1" value="17">
          </div>
          <div class="hint">Typical entry range ~11–72 km/s (we allow 5–72 to explore).</div>
        </div>

        <!-- Estimated mass (informative) -->
        <div class="field">
          <label>Estimated mass (informative)</label>
          <div id="massInfo" class="v">—</div>
          <div class="hint">Computed from mean diameter and selected ρ.</div>
        </div>
      </div>

      <div class="actions">
        <button id="goParams" class="btn primary">Continue to Simulation</button>
        <button id="change" class="btn">Change asteroid</button>
      </div>
    </section>
  </main>

<script>
// ---- data: 10 asteroids (demo/approx values) ----
const ASTEROIDS = [
  { name:"465633 (2009 JR5)", hazardous:true,  diameter_km:[0.217,0.485], speed_kms:18.13 },
  { name:"99942 Apophis",     hazardous:true,  diameter_km:[0.340,0.370], speed_kms: 7.42 },
  { name:"101955 Bennu",      hazardous:true,  diameter_km:[0.492,0.548], speed_kms:12.70 },
  { name:"2010 XT10",         hazardous:false, diameter_km:[0.013,0.030], speed_kms:19.15 },
  { name:"2001 FO32",         hazardous:true,  diameter_km:[0.440,1.000], speed_kms:34.40 },
  { name:"1998 OR2",          hazardous:true,  diameter_km:[1.800,4.100], speed_kms: 8.60 },
  { name:"2015 TB145",        hazardous:false, diameter_km:[0.600,1.300], speed_kms:35.00 },
  { name:"2002 AJ129",        hazardous:true,  diameter_km:[0.300,1.200], speed_kms:12.30 },
  { name:"138971 (2001 CB21)",hazardous:true,  diameter_km:[0.560,1.300], speed_kms:19.00 },
  { name:"3200 Phaethon",     hazardous:true,  diameter_km:[4.500,6.000], speed_kms:31.00 }
];

// ---- UI refs ----
const root=document.getElementById("dropdownRoot");
const btn=document.getElementById("ddBtn");
const caret=document.getElementById("ddCaret");
const label=document.getElementById("ddLabel");
const menu=document.getElementById("ddMenu");

const result=document.getElementById("result");
const rName=document.getElementById("rName");
const rHaz=document.getElementById("rHaz");
const rDia=document.getElementById("rDia");
const rVel=document.getElementById("rVel");

const compSel=document.getElementById("comp");
const rhoTag=document.getElementById("rhoTag");
const velRange=document.getElementById("velRange");
const velInput=document.getElementById("velInput");
const massInfo=document.getElementById("massInfo");

const goParams=document.getElementById("goParams");
const change=document.getElementById("change");

// ---- dropdown ----
let open=false, selected=null;
menu.innerHTML = ASTEROIDS.map(a=>`<li class="dd-item" role="option" data-name="${a.name}">${a.name}</li>`).join("");

function openMenu(){ open=true;  menu.classList.add("show");  btn.setAttribute("aria-expanded","true"); }
function closeMenu(){ open=false; menu.classList.remove("show"); btn.setAttribute("aria-expanded","false"); }

caret.addEventListener("click",(e)=>{e.stopPropagation(); open?closeMenu():openMenu();});
btn.addEventListener("click",(e)=>{e.stopPropagation(); if(!selected) (open?closeMenu():openMenu());});
document.addEventListener("click",(e)=>{ if(!root.contains(e.target)) closeMenu(); });

menu.addEventListener("click",(e)=>{
  const item = e.target.closest(".dd-item"); if(!item) return;
  selected = ASTEROIDS.find(a=>a.name===item.dataset.name);
  label.textContent = selected.name;
  closeMenu();
  fillResult(selected);
});

// ---- helpers ----
function updateRhoTag(){
  const rho = Number(compSel.selectedOptions[0].dataset.density);
  rhoTag.textContent = `ρ = ${rho.toLocaleString()} kg/m³`;
}
function fillResult(a){
  rName.textContent = a.name;
  rHaz.textContent  = a.hazardous ? "Potentially hazardous" : "Not hazardous";
  rDia.textContent  = `${a.diameter_km[0].toFixed(3)}–${a.diameter_km[1].toFixed(3)} km`;
  rVel.textContent  = `${a.speed_kms.toFixed(2)} km/s (ref)`;
  velRange.value = a.speed_kms.toFixed(2);
  velInput.value = a.speed_kms.toFixed(2);
  updateRhoTag();
  updateMassPreview();
  result.classList.remove("hidden");
}
function updateMassPreview(){
  if(!selected){ massInfo.textContent="—"; return; }
  const rho = Number(compSel.selectedOptions[0].dataset.density);
  const dkm = (selected.diameter_km[0]+selected.diameter_km[1])/2;
  const d   = dkm*1000; const r=d/2;
  const vol = (4/3)*Math.PI*Math.pow(r,3);
  const m   = vol*rho;
  massInfo.textContent = `${(m/1000).toLocaleString(undefined,{maximumFractionDigits:0})} tonnes (d≈${dkm.toFixed(3)} km, ρ=${rho.toLocaleString()} kg/m³)`;
}
velRange.addEventListener("input",()=>{ velInput.value = Number(velRange.value).toFixed(2); });
velInput.addEventListener("input",()=>{
  const v = Math.min(72,Math.max(5,Number(velInput.value)));
  velInput.value = isFinite(v)?v:17;
  velRange.value = velInput.value;
});
compSel.addEventListener("change",()=>{ updateRhoTag(); updateMassPreview(); });
change.addEventListener("click",()=> openMenu());

// ---- continue to sim ----
goParams.addEventListener("click", ()=>{
  if(!selected) return;
  const density = Number(compSel.selectedOptions[0].dataset.density);
  const speed   = Number(velInput.value);
  const diameter_km = (selected.diameter_km[0]+selected.diameter_km[1])/2;

  const payload = {
    name: selected.name,
    hazardous: selected.hazardous,
    diameter_km,
    speed_kms: speed,
    composition: compSel.value,
    density_kgm3: density,
    source_speed_ref_kms: selected.speed_kms
  };

  localStorage.setItem("nasaAsteroidChoice", JSON.stringify(payload));
  try{ window.parent && window.parent.postMessage({type:"ASTEROID_SELECTED", payload},"*"); }catch(e){}
  window.location.href = "section3to6_simulation.html";
});
</script>
</body>
</html>
